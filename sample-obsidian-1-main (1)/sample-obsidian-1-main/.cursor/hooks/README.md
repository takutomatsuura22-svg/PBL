# Cursor Hooks 知識資産自動記録システム

このディレクトリには、Cursor AIの作業を自動的にObsidianに記録するためのHooksが含まれています。

## 📋 概要

Cursor Hooksを使って、以下の作業を知識資産として自動記録します：

1. **プロンプト記録** (`beforeSubmitPrompt`)
   - ユーザーが送信したプロンプトを記録
   - 意図（Why）を抽出
   - 学習キーワードを抽出
   - キーワードから参照すべきノートを提案

2. **ファイル編集記録** (`afterFileEdit`)
   - 編集したファイルを記録
   - **注意**: マークダウンファイル（.md, .markdown）のみを処理
   - 学んだ概念・パターンを抽出
   - 意思決定の理由を記録
   - 問題と解決策を記録

3. **セッション終了記録** (`stop`)
   - セッション終了時の記録
   - 達成したことを振り返り
   - メタ認知（作業パターン）を記録
   - 次回のアクションを記録

## 🧠 知識資産として価値のあるログ

### 記録される内容

1. **思考プロセス・意思決定の理由（Why）**
   - なぜこの実装を選んだか
   - 他の選択肢と比較した理由
   - どんな制約・トレードオフを考慮したか

2. **学んだ概念・パターン**
   - 新しく理解した概念
   - 気づいたパターン
   - 一般化できる原則
   - → 独立したZettelとして抽出候補

3. **問題と解決策のペア**
   - 具体的なエラーメッセージ・症状
   - 何をして解決したか
   - なぜこの問題が起きたか

4. **作業コンテキスト・ゴール**
   - このセッションで達成したかったこと
   - プロジェクトの中での位置づけ
   - 関連タスク

5. **疑問と洞察**
   - 作業中に浮かんだ未解決の疑問
   - 作業中のひらめき・発見

6. **失敗・うまくいかなかったこと**
   - 試して失敗したアプローチ
   - なぜ失敗したか、次回避けるには

7. **参照した既存ノート・外部リソース**
   - 既存のZettelへのリンク
   - 外部記事URL
   - 使用したドキュメント

8. **TODO・次のアクション**
   - 残タスク
   - 次回調査すること

9. **メタ認知・振り返り**
   - セッションの質
   - 集中度、生産性
   - 詰まったポイント
   - 改善点

## 🔧 セットアップ

### 1. 環境変数の設定（オプション）

デフォルトでは、現在のワークスペース内に `.logs/` ディレクトリが作成されます。

別のObsidian Vaultにログを保存したい場合は、環境変数を設定します：

```bash
export OBSIDIAN_VAULT="/path/to/your/obsidian/vault"
```

### 2. Cursorの再起動

Cursorを再起動して、Hooksを有効化します。

## 📁 ファイル構成

```
.cursor/
├── hooks.json                 # フック設定ファイル
└── hooks/
    ├── README.md              # このファイル
    ├── common.sh              # 共通ヘルパー関数
    ├── log-prompt.sh          # プロンプト記録
    ├── log-file-edit.sh       # ファイル編集記録
    └── log-session-stop.sh   # セッション終了記録
```

## 📝 ログの保存場所

ログは以下の場所に保存されます：

```
${OBSIDIAN_VAULT:-$(pwd)}/.logs/YYYY-MM-DD/YYYY-MM-DD-HH-MM-SS_ログタイトル.md
```

例：
```
.logs/2025-10-23/2025-10-23-08-18-30_プロンプト_関数を追加してください.md
.logs/2025-10-23/2025-10-23-08-19-15_編集_README.md
.logs/2025-10-23/2025-10-23-08-20-00_セッション終了_完了.md
```

### 注意事項
- `afterFileEdit`フックは**マークダウンファイル（.md, .markdown）のみ**を処理します
- ファイル名は日本語を含む150バイト以内に制限されます
- タイムスタンプは`YYYY-MM-DD-HH-MM-SS`形式です

## 🔐 セキュリティ機能

以下の機密情報が自動的にマスキングされます：

- `password`
- `secret`
- `token`
- `api_key`
- `passwd`
- `pwd`

マスキングされた値は `***MASKED***` に置き換えられます。

## ⚠️ エラーハンドリング

各スクリプトは以下のエラーハンドリングを行います：

- 入力が空の場合、エラーログを記録して処理を継続
- 必須フィールドが欠けている場合、エラーログを記録して処理を継続
- ファイル作成に失敗した場合、エラーログを記録

エラーログは `.logs/YYYY-MM-DD/errors.log` に記録されます。

## 📊 ログフォーマット例

### プロンプト記録（beforeSubmitPrompt）

```markdown
---
type: cursor-session
event: beforeSubmitPrompt
date: 2025-10-23
tags: [cursor, ai-conversation, knowledge]
conversation_id: xxx
generation_id: yyy
status: active
learning_keywords: [React, Hook, Context]
---

# 🧠 2025-10-23-08-18-30_知識記録_プロンプト

## 🎯 目的・意図
<!-- このセッションで達成したかったこと -->
```
[プロンプト内容（最初の500文字）]
```

## 🤔 Why（なぜ）
<!-- なぜこの実装を選んだか、他の選択肢と比較した理由 -->
[意図抽出された内容]

## 💬 AIとの対話
<!-- プロンプト履歴 -->
- **プロンプト**: [要約 - 詳細は下記]
- **コンテキスト**: 3個の添付ファイル

## 📎 参照したノート
- [[関連ノート1]]
- [[関連ノート2]]

## 📎 添付ファイル
- rule: /path/to/file1.md
- rule: /path/to/file2.md

## 📁 ワークスペース
- /path/to/workspace

## 🔗 関連ノート候補
- [[React]]
- [[Hook]]
- [[Context]]

## 💡 学び・気づき
<!-- この対話で理解したこと、気づいたパターン -->
<!-- TODO: ここは後で編集して具体的な学びを記録 -->

## ❓ 疑問・未解決
<!-- 作業中に浮かんだ未解決の疑問 -->
<!-- TODO: 疑問を記録 -->

## 📋 次回のアクション
<!-- このセッション後にやること -->
- [ ] TODO: 具体的なアクションを記録

## 📝 メモ
- セッションID: xxx
- 開始時刻: 2025-10-23-08-18-30
```

### ファイル編集記録（afterFileEdit）

```markdown
---
type: cursor-session
event: afterFileEdit
date: 2025-10-23
tags: [cursor, ai-conversation, file-edit, knowledge]
conversation_id: xxx
generation_id: yyy
status: completed
learning_keywords: [useEffect, dependency]
---

# ✏️ 2025-10-23-08-19-15_編集記録_Component.md

## 🔧 編集ファイル
[[Component]]
`/path/to/Component.md`

## 📊 編集概要
- **編集箇所**: 3箇所を編集
- **カテゴリ**: knowledge

## 📝 編集詳細
- **変更**: 旧コード → 新コード

## 💡 学んだ概念・パターン
<!-- この編集で理解したこと -->
<!-- 例: 「useEffectの依存配列に注意」→ 新規Zettel作成候補 -->
- 技術キーワード: useEffect, dependency
- TODO: この知識を独立したZettelとして抽出する

## 🤔 意思決定・選択理由
<!-- なぜこの実装を選んだか -->
<!-- TODO: 他の選択肢と比較した理由を記録 -->

## 🐛 遭遇した問題
<!-- エラーや詰まったポイント -->
<!-- TODO: エラーメッセージや解決策を記録 -->

## 🔗 関連ノート
<!-- 関連する知識ノートへのリンク -->
- [[useEffect]]
- [[dependency]]
- [[Component]]

## 📋 次回のアクション
<!-- この編集後にやること -->
- [ ] TODO: リファクタリングが必要か確認
- [ ] TODO: テスト追加
- [ ] TODO: ドキュメント更新

## 📁 ワークスペース
- /path/to/workspace

## 📝 メモ
- セッションID: xxx
- 編集時刻: 2025-10-23-08-19-15
```

### セッション終了記録（stop）

```markdown
---
type: cursor-session
event: stop
date: 2025-10-23
tags: [cursor, ai-conversation, session-end, reflection]
conversation_id: xxx
generation_id: yyy
status: completed
---

# ✅ 2025-10-23-08-20-00_セッション終了記録

## 📊 セッション概要
- **ステータス**: completed
- **セッションID**: xxx
- **終了時刻**: 2025-10-23-08-20-00

## 🎯 達成したこと
<!-- このセッションで完了したタスク -->
- [ ] TODO: 完了したタスクを記録

## 💡 学んだこと・気づき
<!-- 新しい理解、気づいたパターン、一般化できる原則 -->
<!-- 例: 「Reactのクロージャトラップ」→ 新規Zettel作成 -->
- TODO: 学びを記録
- TODO: 独立したZettelとして抽出すべき知識を特定

## 🐛 問題と解決策
<!-- 遭遇したエラーとその解決方法 -->
### 問題
<!-- TODO: 具体的なエラーメッセージ・症状 -->
### 解決策
<!-- TODO: 何をして解決したか -->
### 根本原因
<!-- TODO: なぜこの問題が起きたか -->

## 🤔 意思決定と選択理由
<!-- なぜこの実装を選んだか、他の選択肢と比較 -->
<!-- TODO: 判断基準を記録 -->

## ❌ 試して失敗したこと
<!-- うまくいかなかったアプローチ -->
- TODO: 失敗したアプローチと理由を記録

## 📖 参照したリソース
<!-- 既存ノート、外部記事、ドキュメント -->
- TODO: 参照したリソースを記録
  - [[関連ノート]]
  - [外部URL]

## 📋 次回のアクション
<!-- このセッション後にやること -->
- [ ] TODO: 残タスク
- [ ] TODO: リファクタリング
- [ ] TODO: テスト追加
- [ ] TODO: 調査事項

## 🎭 セッションの質（振り返り）
<!-- メタ認知：自分の作業パターンを理解 -->
- **集中度**: ⭐⭐⭐⭐☆
- **生産性**: TODO: 記録
- **詰まったポイント**: TODO: 記録
- **改善点**: TODO: 次回もっとうまくやるには

## 💭 洞察・疑問
<!-- 作業中のひらめき・発見、未解決の疑問 -->
- TODO: 洞察を記録
- TODO: 疑問を記録（後の研究テーマに）

## 🔗 関連ノート
<!-- このセッションで作成・編集したノート -->
<!-- TODO: 実際に作成したノートへのリンク -->

## 📁 ワークスペース
- /path/to/workspace

## 📝 メモ
- セッションID: xxx
- 終了時刻: 2025-10-23-08-20-00
```

## 🛠️ トラブルシューティング

### Hooksが動作しない場合

1. **Cursorを再起動**
   Hooksの設定変更はCursorの再起動が必要です。

2. **スクリプトの実行権限を確認**
   ```bash
   ls -la .cursor/hooks/
   ```
   すべての `.sh` ファイルに実行権限（`-rwxr-xr-x`）があることを確認してください。
   ない場合は、以下を実行：
   ```bash
   chmod +x .cursor/hooks/*.sh
   ```

3. **エラーログを確認**
   ```bash
   cat .logs/$(date +%Y-%m-%d)/errors.log
   ```
   エラーが記録されている場合は、その内容を確認してください。

4. **Cursorの設定で確認**
   Cursorの設定 > Hooks タブで、設定済みのHooksと実行履歴を確認できます。

### よくあるエラー

#### `jq: command not found`
`jq`がインストールされていない場合：
```bash
# macOS
brew install jq

# Ubuntu/Debian
sudo apt-get install jq
```

#### ログディレクトリが作成されない
環境変数 `OBSIDIAN_VAULT` が正しく設定されているか確認してください。

## 💡 ベストプラクティス

### ログを最大限活用する

1. **TODOを埋める**
   - 各ログにはTODOセクションがあります
   - セッション後に、TODOを埋めて知識を定着させましょう

2. **独立したZettelを作成**
   - 学んだ概念は独立したZettelとして抽出
   - 例：「useEffectの依存配列」→ `08_Knowledge/React/useEffect依存配列の注意点.md`

3. **関連ノートにリンク**
   - 既存のノートとの関連を明示
   - Graph Viewで知識マップを形成

4. **定期的に振り返り**
   - 週次レビューで、ログを振り返る
   - 繰り返し起きる問題、パターンを特定

## 🎯 本質

単なる作業ログ → **未来の自分への知識資産**

記録すべきは：
- ✅ **Why（なぜ）** - 意思決定の理由
- ✅ **What I learned（学び）** - 新しい理解
- ✅ **Patterns（パターン）** - 繰り返し使える知識
- ✅ **Connections（繋がり）** - 他の知識との関連

これでCursorでの作業が、検索可能で繋がった**Living Knowledge Base**になります！

## 📖 参考リンク

- [Cursor Hooks公式ドキュメント](https://docs.cursor.com/core/hooks)
- [Obsidian 公式サイト](https://obsidian.md/)

## 🔄 更新履歴

- 2025-10-23: 初版作成（知識資産記録システム）
- 2025-01-22: ソースコードに合わせてREADME.mdを更新
  - ファイル編集記録はマークダウンファイルのみを処理することを明記
  - ログフォーマット例を実際の実装に合わせて更新
  - エラーハンドリングの説明を追加
  - ファイル名の制限（150バイト）を明記
